<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ä¿®æ”¹è¿™é‡Œçš„æ ‡é¢˜ -->
    <title>æµ·è±¹å…¬å¸</title>
    
    <style>
        /* åŸºç¡€ä¿æŠ¤æ ·å¼ */
        body {
            -webkit-touch-callout: none;    /* iOS Safari */
            -webkit-user-select: none;      /* Safari */
            -khtml-user-select: none;       /* Konqueror HTML */
            -moz-user-select: none;         /* Firefox */
            -ms-user-select: none;          /* Internet Explorer/Edge */
            user-select: none;              /* æ ‡å‡†è¯­æ³• */
            cursor: default;                /* é»˜è®¤å…‰æ ‡ */
        }
    </style>
    
    <script>
        // ========== ç¦ç”¨å³é”®èœå• ==========
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // ========== ç¦ç”¨é”®ç›˜å¿«æ·é”® ==========
        document.addEventListener('keydown', function(e) {
            const key = e.key || e.keyCode;
            const ctrl = e.ctrlKey || e.metaKey;
            const shift = e.shiftKey;
            
            // é˜»æ­¢çš„å¿«æ·é”®åˆ—è¡¨
            const blockedCombinations = [
                // F12
                { condition: key === 'F12' || e.keyCode === 123 },
                // Ctrl+U (æŸ¥çœ‹æºä»£ç )
                { condition: ctrl && (key === 'u' || e.keyCode === 85) },
                // Ctrl+Shift+I (å¼€å‘è€…å·¥å…·)
                { condition: ctrl && shift && (key === 'I' || e.keyCode === 73) },
                // Ctrl+Shift+J (æ§åˆ¶å°)
                { condition: ctrl && shift && (key === 'J' || e.keyCode === 74) },
                // Ctrl+S (ä¿å­˜ç½‘é¡µ)
                { condition: ctrl && (key === 's' || e.keyCode === 83) },
                // Ctrl+Shift+C (æ£€æŸ¥å…ƒç´ )
                { condition: ctrl && shift && (key === 'C' || e.keyCode === 67) },
                // Ctrl+P (æ‰“å°)
                { condition: ctrl && (key === 'p' || e.keyCode === 80) },
                // Ctrl+N (æ–°å»ºçª—å£)
                { condition: ctrl && (key === 'n' || e.keyCode === 78) }
            ];
            
            for (const combo of blockedCombinations) {
                if (combo.condition) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            }
        });
        
        // ========== ç¦ç”¨æ–‡æœ¬é€‰æ‹© ==========
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });
        
        // ========== ç¦ç”¨æ‹–æ‹½ ==========
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });
        
        // ========== å¼€å‘è€…å·¥å…·æ£€æµ‹ ==========
        (function() {
            // ç®€å•çš„å¼€å‘è€…å·¥å…·æ£€æµ‹
            const element = new Image();
            Object.defineProperty(element, 'id', {
                get: function() {
                    // å½“æ§åˆ¶å°æ‰“å¼€æ—¶è°ƒç”¨
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–å¤„ç†é€»è¾‘
                }
            });
            
            console.log('%c ', element);
            
            // å®šæœŸæ£€æŸ¥çª—å£å¤§å°å˜åŒ–
            setInterval(() => {
                const widthThreshold = window.outerWidth - window.innerWidth > 100;
                const heightThreshold = window.outerHeight - window.innerHeight > 100;
                
                if (widthThreshold || heightThreshold) {
                    // æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·æ‰“å¼€
                }
            }, 1000);
            
            // æ£€æµ‹æ§åˆ¶å°æ‰“å¼€
            const devtools = {
                open: false,
                orientation: null
            };
            
            const threshold = 160;
            
            const emitEvent = (isOpen, orientation) => {
                if (devtools.open !== isOpen || devtools.orientation !== orientation) {
                    devtools.open = isOpen;
                    devtools.orientation = orientation;
                }
            };
            
            setInterval(() => {
                const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                
                if (!(window.Firebug && window.Firebug.chrome && window.Firebug.chrome.isInitialized) || widthThreshold || heightThreshold) {
                    if (!devtools.open || devtools.orientation !== (widthThreshold ? 'vertical' : 'horizontal')) {
                        emitEvent(true, widthThreshold ? 'vertical' : 'horizontal');
                    }
                } else {
                    if (devtools.open) {
                        emitEvent(false, null);
                    }
                }
            }, 500);
        })();
        
        // ========== é¡µé¢åŠ è½½å®Œæˆ ==========
        document.addEventListener('DOMContentLoaded', function() {
            // å¹²æ‰°æ§åˆ¶å°
            if (typeof console !== 'undefined') {
                // é‡å†™consoleæ–¹æ³•
                const originalLog = console.log;
                const originalWarn = console.warn;
                const originalError = console.error;
                const originalClear = console.clear;
                
                console.log = function(...args) {
                    originalLog.apply(console, ['ğŸ”’', ...args]);
                };
                
                console.warn = function(...args) {
                    originalWarn.apply(console, ['âš ï¸ è­¦å‘Šï¼š', ...args]);
                };
                
                console.error = function(...args) {
                    originalError.apply(console, ['âŒ é”™è¯¯ï¼š', ...args]);
                };
                
                console.clear = function() {
                    // é˜»æ­¢æ¸…é™¤æ§åˆ¶å°
                    originalLog.apply(console, ['æ§åˆ¶å°æ¸…é™¤å·²ç¦ç”¨']);
                };
            }
            
            // æ·»åŠ å‡çš„æŸ¥çœ‹æºä»£ç æŒ‰é’®ï¼ˆå¯é€‰ï¼‰
            if (false) { // è®¾ç½®ä¸ºtrueå¯ç”¨ä¼ªè£…æŒ‰é’®
                addFakeViewSourceButton();
            }
        });
        
        // ========== ä¼ªè£…æŸ¥çœ‹æºä»£ç æŒ‰é’®ï¼ˆå¯é€‰ï¼‰ ==========
        function addFakeViewSourceButton() {
            const button = document.createElement('button');
            button.innerHTML = 'ğŸ“„ æŸ¥çœ‹æºä»£ç ';
            button.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 25px;
                cursor: pointer;
                z-index: 1000;
                font-size: 14px;
                font-weight: bold;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
            `;
            
            button.onmouseover = function() {
                this.style.transform = 'scale(1.05)';
                this.style.boxShadow = '0 6px 20px rgba(0,0,0,0.3)';
            };
            
            button.onmouseout = function() {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
            };
            
            button.onclick = function() {
                const fakeWindow = document.createElement('div');
                fakeWindow.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #1a1a1a;
                    color: #00ff00;
                    font-family: 'Courier New', monospace;
                    padding: 20px;
                    z-index: 9998;
                    overflow: auto;
                    white-space: pre;
                    font-size: 14px;
                `;
                
                fakeWindow.innerHTML = `
                    <div style="text-align: right; margin-bottom: 20px;">
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="background: #ff4757; color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer;">
                            å…³é—­
                        </button>
                    </div>
                    <div style="color: #ffa502; margin-bottom: 20px;">
                        // ================================================
                        //             ğŸ”’ å—ä¿æŠ¤çš„æºä»£ç 
                        // ================================================
                        // æ­¤é¡µé¢æºä»£ç å·²åŠ å¯†ï¼Œç¦æ­¢è®¿é—®ï¼
                        // å¦‚éœ€æŸ¥çœ‹æºä»£ç ï¼Œè¯·è”ç³»ç®¡ç†å‘˜è·å–æƒé™ã€‚
                        // ================================================
                    </div>
                    <div>
                        // åŠ å¯†ä»£ç ç‰‡æ®µ...
                        function encryptedFunction() {
                            return "ä»£ç å·²åŠ å¯†";
                        }
                        
                        // æ›´å¤šåŠ å¯†å†…å®¹...
                        console.log("è®¿é—®è¢«æ‹’ç»");
                        // æœ€åæ›´æ–°: ${new Date().toLocaleString()}
                    </div>
                `;
                
                document.body.appendChild(fakeWindow);
            };
            
            document.body.appendChild(button);
        }
        
        // ========== é˜²æ­¢å¤åˆ¶åˆ°å‰ªè´´æ¿ ==========
        document.addEventListener('copy', function(e) {
            e.preventDefault();
            return false;
        });
        
        document.addEventListener('cut', function(e) {
            e.preventDefault();
            return false;
        });
        
        // ========== é˜²æ­¢ç²˜è´´ ==========
        document.addEventListener('paste', function(e) {
            e.preventDefault();
            return false;
        });
        
        // ========== é˜²æ­¢æ‰“å°é¡µé¢ ==========
        window.addEventListener('beforeprint', function(e) {
            e.preventDefault();
            return false;
        });
        
        // ========== é˜²æ­¢ä¿å­˜é¡µé¢ ==========
        window.addEventListener('beforeunload', function(e) {
            // é˜²æ­¢æŸäº›æƒ…å†µä¸‹çš„é¡µé¢ä¿å­˜
        });
        
        // ========== é˜²æ­¢iframeåµŒå…¥ ==========
        if (window.top !== window.self) {
            window.top.location = window.self.location;
        }
        
        // ========== é˜²æ­¢é”®ç›˜æ”»å‡» ==========
        document.addEventListener('keydown', function(e) {
            // ç¦ç”¨æŸäº›åŠŸèƒ½é”®
            const disabledKeys = [
                116, // F5
                123  // F12
            ];
            
            if (disabledKeys.includes(e.keyCode)) {
                e.preventDefault();
                return false;
            }
        });
        
    </script>
</head>
<body>
    <!-- ä½ çš„é¡µé¢å†…å®¹ä»è¿™é‡Œå¼€å§‹ -->
    <!-- æ³¨æ„ï¼šä¸Šé¢çš„ä¿æŠ¤ä»£ç å¿…é¡»æ”¾åœ¨æ‰€æœ‰å†…å®¹ä¹‹å‰ -->
    <!-- æŠŠåŸæ¥çš„é¡µé¢å†…å®¹æ”¾åœ¨è¿™é‡Œ -->
    
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­çº§åˆ†æ•°ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .menu {
            margin: 20px 0;
            padding: 15px;
            background-color: #e9f5ff;
            border-radius: 6px;
        }
        
        .menu h2 {
            margin-bottom: 10px;
            color: #007bff;
        }
        
        .menu ul {
            list-style: none;
            margin-left: 20px;
        }
        
        .menu li {
            margin: 8px 0;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input {
            padding: 8px;
            width: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        th {
            background-color: #007bff;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .message {
            margin: 15px 0;
            padding: 10px;
            border-radius: 4px;
            background-color: #d4edda;
            color: #155724;
            display: none;
        }
        
        .low-score {
            color: red;
            font-weight: bold;
        }
        
        /* ç™»å½•ç›¸å…³æ ·å¼ */
        .login-container {
            display: none;
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .auth-controls {
            display: none;
            text-align: right;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .login-btn {
            background-color: #28a745;
        }
        
        .login-btn:hover {
            background-color: #218838;
        }
        
        .logout-btn {
            background-color: #dc3545;
        }
        
        .logout-btn:hover {
            background-color: #c82333;
        }
        
        .disabled-btn {
            background-color: #6c757d !important;
            cursor: not-allowed;
        }
        
        .disabled-btn:hover {
            background-color: #5a6268 !important;
        }
        
        .info-text {
            color: #6c757d;
            font-style: italic;
            margin: 10px 0;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        
        /* ä¿®æ”¹åˆ†æ•°æŒ‰é’®ç»„æ ·å¼ */
        .change-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .btn-add {
            background-color: #28a745;
        }
        
        .btn-add:hover {
            background-color: #218838;
        }
        
        .btn-minus {
            background-color: #dc3545;
        }
        
        .btn-minus:hover {
            background-color: #c82333;
        }
        
        .change-record {
            font-size: 12px;
            color: #666;
            font-style: italic;
        }
        
        .positive {
            color: #28a745;
        }
        
        .negative {
            color: #dc3545;
        }
        
        .batch-controls {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .batch-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .batch-input input {
            width: 100px;
        }
        
        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        
        .original-score {
            font-size: 12px;
            color: #888;
        }
        
        .temp-change {
            font-weight: bold;
        }
        
        /* æ–°å¢ï¼šåŒæ­¥ç›¸å…³æ ·å¼ - è¶…ç®€æ´ç‰ˆ */
        .sync-container {
            display: none;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: white;
        }
        
        .sync-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 5px 0;
        }
        
        .btn-sync {
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            font-size: 14px;
            color: white;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-sync:hover {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .sync-help-btn {
            background-color: rgba(108, 117, 125, 0.7);
            width: 36px;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sync-title {
            font-size: 16px;
            margin-bottom: 8px;
            color: white;
            font-weight: bold;
        }
        
        .modal-wide {
            max-width: 500px !important;
        }
        
        .sync-instruction {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            text-align: left;
        }
        
        .sync-instruction ol {
            margin-left: 20px;
        }
        
        .sync-instruction li {
            margin: 8px 0;
        }
        
        /* åˆ†äº«é“¾æ¥å¼¹çª—æ ·å¼ */
        .share-link-textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            font-family: monospace;
            border: 2px solid #007bff;
            border-radius: 4px;
            resize: none;
            font-size: 12px;
            margin: 10px 0;
        }
        
        .share-instruction {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .data-info {
            background-color: #e8f4fd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="auth-controls" id="authControls">
            <span style="margin-right: 15px;">å·²ç™»å½•ä¸ºç®¡ç†å‘˜</span>
            <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
        </div>
        
        <h1>ç­çº§åˆ†æ•°ç®¡ç†ç³»ç»Ÿ</h1>
        
        <div class="login-container" id="loginContainer">
            <h2>ç®¡ç†å‘˜ç™»å½•</h2>
            <div class="input-group">
                <label for="password">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼š</label>
                <input type="password" id="password" placeholder="è¾“å…¥å¯†ç ">
            </div>
            <button class="login-btn" onclick="login()">ç™»å½•</button>
            <p class="info-text">æœªç™»å½•æ—¶åªèƒ½æŸ¥çœ‹åˆ†æ•°ï¼Œç™»å½•åæ‰èƒ½ä¿®æ”¹å’Œä¿å­˜æ•°æ®</p>
        </div>
        
        <!-- æ–°å¢ï¼šåŒæ­¥é¢æ¿ - è¶…ç®€æ´ç‰ˆ -->
        <div class="sync-container" id="syncContainer" style="display: none;">
            <div class="sync-title">ğŸ”— è·¨è®¾å¤‡åŒæ­¥</div>
            <div class="sync-controls">
                <button class="btn-sync" onclick="generateShareLink()">
                    <span style="font-size: 16px;">ğŸ“¤</span> åˆ†äº«æ•°æ®
                </button>
                <button class="btn-sync sync-help-btn" onclick="showSyncHelp()" title="ä½¿ç”¨å¸®åŠ©">
                    â“
                </button>
            </div>
        </div>
        
        <div class="menu">
            <h2>æ“ä½œæŒ‡ä»¤</h2>
            <ul>
                <li>1: æ˜¾ç¤ºåˆ†æ•°åå•</li>
                <li>2: å¢å‡åˆ†æ•°ï¼ˆéœ€ç™»å½•ï¼‰</li>
                <li>3: è®¾ç½®æŸæˆå‘˜åˆ†æ•°ï¼ˆéœ€ç™»å½•ï¼‰</li>
                <li>4: é‡ç½®åˆ†æ•°ä¸º100ï¼ˆéœ€ç™»å½•ï¼‰</li>
                <li>5: æ˜¾ç¤ºåˆ†æ•°è¿‡ä½æˆå‘˜</li>
                <li>6: ä¿å­˜æ•°æ®ï¼ˆéœ€ç™»å½•ï¼‰</li>
                <li>7: è·¨è®¾å¤‡åŒæ­¥ï¼ˆéœ€ç™»å½•ï¼‰</li>
            </ul>
        </div>
        
        <div class="btn-group">
            <button onclick="showScoreList()">1. æ˜¾ç¤ºåˆ†æ•°åå•</button>
            <button id="btnAddScore" onclick="openChangeScoreModal()">2. å¢å‡åˆ†æ•°</button>
            <button id="btnSetScore" onclick="openSetScoreModal()">3. è®¾ç½®åˆ†æ•°</button>
            <button id="btnReset" onclick="resetAllScores()">4. é‡ç½®åˆ†æ•°</button>
            <button onclick="showLowScores()">5. æŸ¥çœ‹ä½åˆ†æˆå‘˜</button>
            <button id="btnSave" onclick="saveData()">6. ä¿å­˜æ•°æ®</button>
            <button id="btnSync" onclick="showSyncPanel()">7. è·¨è®¾å¤‡åŒæ­¥</button>
        </div>
        
        <div id="message" class="message"></div>
        <div id="content"></div>
    </div>

    <!-- å¢å‡åˆ†æ•°å¼¹çª— -->
    <div id="changeScoreModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeChangeScoreModal()">&times;</span>
            <h2>æ‰¹é‡å¢å‡åˆ†æ•°</h2>
            
            <div class="batch-controls">
                <div class="batch-input">
                    <label>æ‰¹é‡å¢å‡ï¼š</label>
                    <input type="number" id="batchChangeValue" placeholder="åˆ†æ•°å€¼" value="5">
                    <button class="btn-small btn-add" onclick="applyBatchChange('add')">æ‰¹é‡å¢åŠ </button>
                    <button class="btn-small btn-minus" onclick="applyBatchChange('minus')">æ‰¹é‡å‡å°‘</button>
                </div>
                <div>
                    <button onclick="clearAllChanges()">æ¸…ç©ºæ‰€æœ‰æ›´æ”¹</button>
                    <button onclick="applyAllChanges()" style="background-color: #28a745;">åº”ç”¨æ‰€æœ‰æ›´æ”¹</button>
                </div>
            </div>
            
            <div id="changeScoreContent">
                <!-- åŠ¨æ€ç”Ÿæˆè¡¨æ ¼ -->
            </div>
            
            <div class="modal-actions">
                <button onclick="closeChangeScoreModal()">å–æ¶ˆ</button>
                <button onclick="saveChanges()" style="background-color: #007bff;">ä¿å­˜åˆ°ç³»ç»Ÿ</button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®åˆ†æ•°å¼¹çª— -->
    <div id="setScoreModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('setScoreModal')">&times;</span>
            <h2>è®¾ç½®æˆå‘˜åˆ†æ•°</h2>
            <div class="input-group">
                <label for="setStudentNo">æˆå‘˜åº§å·(1-46)ï¼š</label>
                <input type="number" id="setStudentNo" min="1" max="46">
            </div>
            <div class="input-group">
                <label for="setScoreValue">è®¾ç½®åˆ†æ•°å€¼ï¼š</label>
                <input type="number" id="setScoreValue">
            </div>
            <button onclick="setScore()">ç¡®è®¤è®¾ç½®</button>
        </div>
    </div>

    <!-- æ–°å¢ï¼šåŒæ­¥å¸®åŠ©å¼¹çª— -->
    <div id="syncHelpModal" class="modal">
        <div class="modal-content modal-wide">
            <span class="close" onclick="closeModal('syncHelpModal')">&times;</span>
            <h2>ğŸ“š åŒæ­¥ä½¿ç”¨æŒ‡å—</h2>
            
            <div class="sync-instruction">
                <h3>ä½¿ç”¨æ–¹æ³•ï¼š</h3>
                <ol>
                    <li><strong>åœ¨ç”µè„‘Aä¸Šï¼š</strong>ç‚¹å‡»"åˆ†äº«æ•°æ®"æŒ‰é’®</li>
                    <li><strong>å¤åˆ¶ç”Ÿæˆçš„é“¾æ¥</strong>ï¼Œé€šè¿‡å¾®ä¿¡/QQ/é‚®ä»¶å‘é€åˆ°ç”µè„‘B</li>
                    <li><strong>åœ¨ç”µè„‘Bä¸Šï¼š</strong>ç”¨æµè§ˆå™¨æ‰“å¼€è¯¥é“¾æ¥</li>
                    <li>ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ•°æ®å¹¶è¯¢é—®æ˜¯å¦å¯¼å…¥</li>
                    <li>ç‚¹å‡»"ç¡®å®š"å³å¯å®ŒæˆåŒæ­¥</li>
                </ol>
            </div>
            
            <div class="sync-instruction">
                <h4>ğŸ’¡ æç¤ºï¼š</h4>
                <ul>
                    <li>é“¾æ¥åŒ…å«æ‰€æœ‰åˆ†æ•°æ•°æ®ï¼Œè¯·å‹¿æ³„éœ²</li>
                    <li>é“¾æ¥24å°æ—¶å†…æœ‰æ•ˆ</li>
                    <li>å¯ä»¥åœ¨ä¸åŒç”µè„‘ã€æ‰‹æœºé—´åŒæ­¥</li>
                    <li>å»ºè®®ä¿®æ”¹åˆ†æ•°åç«‹å³åˆ†äº«</li>
                </ul>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="closeModal('syncHelpModal')" style="padding: 10px 30px;">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== ç³»ç»Ÿé…ç½® ====================
        // é»˜è®¤å¯†ç ä¸º "admin123"
        const DEFAULT_PASSWORD = "135seventeen";
        
        // å­¦ç”Ÿå§“åæ•°æ®
        const studentNames = [
            "", // å ä½ï¼Œä½¿ç´¢å¼•ä»1å¼€å§‹
            "éƒ‘ç¿Šæ–‡", "æé’ä½©", "å€ªå‹æ™–", "é™¶æ³“æº", "æ¨æµ·æ°",
            "èµµç¾½ç¦¾", "æ—èŠ·å…®", "é™ˆæ³½è¥¿", "æ½˜å®¶ä¹", "å¾æ™¨ç¥",
            "é‚µå‘å—", "æ—ç±³è¯º", "ä½™é™è±", "å•å˜‰ç¨‹", "æ¨é’å·",
            "æ—æ•¬æ’", "å´æ‡¿èˆª", "å¾å­æ°", "éƒ­ä»¥ç¿”", "è“æ˜•å¦",
            "é©¬æ¢“æ’", "å´æ˜ ç¼‡", "ç¿å©§å¿ƒ", "æ  è®º", "æ¨é”¦å®",
            "é™ˆç¥æ±", "èƒ¡è½©èµ«", "æ—å­çª", "æ—ç¨»æ¬£", "æ—å­è°¦",
            "å¼ æ¡æ»”", "åˆ˜æ¢“ç¿", "æ±Ÿæˆä»ª", "æ—åæ­£", "è’‹é›¨å¢¨",
            "æ±Ÿæ—é‘«", "å¼ æ­£è½©", "æ—æ¥šç’‡", "ç‹ä¸ç’ ", "ç‹ç´«è½©",
            "é»„æµ©ç„¶", "ç™½æ€ç¿", "éƒ­ä½³ç¿", "é«˜è¯­å©•", "æ—èŠ®æ¶µ",
            "å»–å®‡è²"
        ];

        // åˆ†æ•°æ•°ç»„ï¼Œåˆå§‹åŒ–æ‰€æœ‰åˆ†æ•°ä¸º100
        let scores = new Array(47).fill(100); // ç´¢å¼•0ä¸ç”¨ï¼Œ1-46å¯¹åº”å­¦ç”Ÿ
        
        // ä¸´æ—¶æ›´æ”¹è®°å½•ï¼Œç”¨äºå¢å‡åˆ†æ•°ç•Œé¢
        let tempChanges = {};
        
        // ç™»å½•çŠ¶æ€
        let isLoggedIn = false;
        
        // é¡µé¢åŠ è½½æ—¶ä»æœ¬åœ°å­˜å‚¨è¯»å–æ•°æ®å¹¶æ£€æŸ¥URLå‚æ•°
        window.onload = function() {
            loadFromLocalStorage();
            checkLoginStatus();
            checkUrlForData(); // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰åˆ†äº«çš„æ•°æ®
            showMessage("ç³»ç»Ÿå·²åŠ è½½ï¼Œå½“å‰å…±æœ‰46åå­¦ç”Ÿæ•°æ®");
        };

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const savedLogin = localStorage.getItem("classSystemLoggedIn");
            const savedPassword = localStorage.getItem("classSystemPassword");
            
            // å¦‚æœæœ‰ä¿å­˜çš„ç™»å½•çŠ¶æ€ä¸”å¯†ç å­˜åœ¨
            if (savedLogin === "true" && savedPassword) {
                isLoggedIn = true;
                updateUIForLogin();
            } else {
                isLoggedIn = false;
                updateUIForLogout();
            }
        }

        // æ›´æ–°UIä¸ºç™»å½•çŠ¶æ€
        function updateUIForLogin() {
            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("authControls").style.display = "block";
            document.getElementById("syncContainer").style.display = "block";
            
            // å¯ç”¨æ‰€æœ‰æŒ‰é’®
            document.getElementById("btnAddScore").classList.remove("disabled-btn");
            document.getElementById("btnSetScore").classList.remove("disabled-btn");
            document.getElementById("btnReset").classList.remove("disabled-btn");
            document.getElementById("btnSave").classList.remove("disabled-btn");
            document.getElementById("btnSync").classList.remove("disabled-btn");
        }

        // æ›´æ–°UIä¸ºç™»å‡ºçŠ¶æ€
        function updateUIForLogout() {
            document.getElementById("loginContainer").style.display = "block";
            document.getElementById("authControls").style.display = "none";
            document.getElementById("syncContainer").style.display = "none";
            
            // æ¸…ç©ºå¯†ç è¾“å…¥æ¡†
            document.getElementById("password").value = "";
            
            // ç¦ç”¨éœ€è¦ç™»å½•çš„æŒ‰é’®
            document.getElementById("btnAddScore").classList.add("disabled-btn");
            document.getElementById("btnSetScore").classList.add("disabled-btn");
            document.getElementById("btnReset").classList.add("disabled-btn");
            document.getElementById("btnSave").classList.add("disabled-btn");
            document.getElementById("btnSync").classList.add("disabled-btn");
            
            tempChanges = {};
        }

        // ç™»å½•å‡½æ•°
        function login() {
            const passwordInput = document.getElementById("password").value;
            const savedPassword = localStorage.getItem("classSystemPassword") || DEFAULT_PASSWORD;
            
            if (passwordInput === savedPassword) {
                isLoggedIn = true;
                localStorage.setItem("classSystemLoggedIn", "true");
                updateUIForLogin();
                showMessage("ç™»å½•æˆåŠŸï¼æ‚¨ç°åœ¨å¯ä»¥ä¿®æ”¹å’Œä¿å­˜åˆ†æ•°æ•°æ®");
            } else {
                showMessage("å¯†ç é”™è¯¯ï¼è¯·é‡è¯•", "error");
                document.getElementById("password").value = "";
            }
        }

        // ç™»å‡ºå‡½æ•°
        function logout() {
            isLoggedIn = false;
            localStorage.removeItem("classSystemLoggedIn");
            updateUIForLogout();
            
            // æ¸…ç©ºä¸´æ—¶æ›´æ”¹
            tempChanges = {};
            
            showMessage("å·²æˆåŠŸç™»å‡º");
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem("classScores");
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    // éªŒè¯æ•°æ®æœ‰æ•ˆæ€§
                    if (Array.isArray(parsedData) && parsedData.length === 47) {
                        scores = parsedData;
                        showMessage("æˆåŠŸä»æœ¬åœ°åŠ è½½åˆ†æ•°æ•°æ®");
                        return true;
                    }
                } catch (e) {
                    showMessage("åŠ è½½æ•°æ®å‡ºé”™ï¼Œä½¿ç”¨é»˜è®¤åˆ†æ•°100", "error");
                }
            }
            // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
            scores = new Array(47).fill(100);
            showMessage("æœªæ‰¾åˆ°ä¿å­˜çš„æ•°æ®ï¼Œæ‰€æœ‰åˆ†æ•°å·²è®¾ä¸º100");
            return false;
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveData() {
            if (!isLoggedIn) {
                showMessage("è¯·å…ˆç™»å½•æ‰èƒ½ä¿å­˜æ•°æ®", "error");
                return false;
            }
            
            try {
                localStorage.setItem("classScores", JSON.stringify(scores));
                showMessage("æˆåŠŸä¿å­˜46ä¸ªå­¦ç”Ÿçš„åˆ†æ•°æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨");
                return true;
            } catch (e) {
                showMessage("ä¿å­˜å¤±è´¥ï¼š" + e.message, "error");
                const confirmQuit = confirm("ä¿å­˜å¤±è´¥ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ");
                if (!confirmQuit) {
                    return false;
                }
            }
            return true;
        }

        // ==================== åˆ†äº«é“¾æ¥åŒæ­¥åŠŸèƒ½ ====================
        
        // ç”Ÿæˆåˆ†äº«é“¾æ¥
        function generateShareLink() {
            if (!isLoggedIn) {
                showMessage("è¯·å…ˆç™»å½•æ‰èƒ½åˆ†äº«æ•°æ®", "error");
                return;
            }
            
            // å‡†å¤‡è¦åˆ†äº«çš„æ•°æ®
            const shareData = {
                scores: scores.slice(1),
                timestamp: new Date().toISOString(),
                version: "1.0",
                studentCount: 46,
                // æ·»åŠ æ ¡éªŒç é˜²æ­¢æ•°æ®ç¯¡æ”¹
                checksum: scores.slice(1).reduce((sum, score) => sum + score, 0)
            };
            
            // å°†æ•°æ®ç¼–ç ä¸ºBase64
            const encodedData = btoa(JSON.stringify(shareData));
            
            // ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼ˆä½¿ç”¨URLç‰‡æ®µï¼Œä¸ä¼šåˆ·æ–°é¡µé¢ï¼‰
            const currentUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${currentUrl}#data=${encodedData}`;
            
            // åˆ›å»ºå¹¶æ˜¾ç¤ºåˆ†äº«å¼¹çª—
            const shareModal = document.createElement('div');
            shareModal.innerHTML = `
                <div class="modal" style="display: flex;" id="shareLinkModal">
                    <div class="modal-content" style="max-width: 500px;">
                        <span class="close" onclick="closeShareLinkModal()">&times;</span>
                        <h2>ğŸ“¤ ç”Ÿæˆåˆ†äº«é“¾æ¥</h2>
                        
                        <div class="data-info">
                            <p><strong>åŒ…å«æ•°æ®ï¼š</strong>46åå­¦ç”Ÿåˆ†æ•°</p>
                            <p><strong>ç”Ÿæˆæ—¶é—´ï¼š</strong>${new Date().toLocaleString()}</p>
                        </div>
                        
                        <div class="share-instruction">
                            <p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
                            <ol style="margin-left: 20px;">
                                <li>å¤åˆ¶ä¸‹é¢çš„é“¾æ¥</li>
                                <li>å‘é€åˆ°å¦ä¸€å°è®¾å¤‡ï¼ˆå¾®ä¿¡/QQ/é‚®ä»¶ï¼‰</li>
                                <li>åœ¨å¦ä¸€å°è®¾å¤‡ä¸Šç”¨æµè§ˆå™¨æ‰“å¼€</li>
                                <li>ç³»ç»Ÿä¼šè‡ªåŠ¨å¯¼å…¥æ•°æ®</li>
                            </ol>
                        </div>
                        
                        <textarea class="share-link-textarea" id="shareLinkText" readonly>${shareUrl}</textarea>
                        
                        <div style="text-align: center;">
                            <button onclick="copyShareLink()" style="background-color: #28a745; padding: 10px 20px; margin-right: 10px;">
                                ğŸ“‹ å¤åˆ¶é“¾æ¥
                            </button>
                            <button onclick="testShareLink()" style="background-color: #17a2b8; padding: 10px 20px; margin-right: 10px;">
                                ğŸ”— æµ‹è¯•é“¾æ¥
                            </button>
                            <button onclick="closeShareLinkModal()" style="padding: 10px 20px;">
                                å…³é—­
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(shareModal);
        }

        // å…³é—­åˆ†äº«é“¾æ¥å¼¹çª—
        function closeShareLinkModal() {
            const modal = document.getElementById('shareLinkModal');
            if (modal) {
                modal.remove();
            }
        }

        // å¤åˆ¶åˆ†äº«é“¾æ¥
        function copyShareLink() {
            const textarea = document.getElementById('shareLinkText');
            if (!textarea) return;
            
            textarea.select();
            textarea.setSelectionRange(0, 99999); // å¯¹äºç§»åŠ¨è®¾å¤‡
            
            try {
                document.execCommand('copy');
                showMessage("âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼è¯·å‘é€åˆ°å¦ä¸€å°è®¾å¤‡");
            } catch (err) {
                // å¦‚æœexecCommandå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨Clipboard API
                navigator.clipboard.writeText(textarea.value).then(() => {
                    showMessage("âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼è¯·å‘é€åˆ°å¦ä¸€å°è®¾å¤‡");
                }).catch(() => {
                    showMessage("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶é“¾æ¥", "error");
                });
            }
        }

        // æµ‹è¯•åˆ†äº«é“¾æ¥
        function testShareLink() {
            const textarea = document.getElementById('shareLinkText');
            if (!textarea) return;
            
            const shareUrl = textarea.value;
            
            // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
            window.open(shareUrl, '_blank');
            
            showMessage("âœ… å·²åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºå¯¼å…¥æç¤º", "info");
        }

        // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰åˆ†äº«çš„æ•°æ®
        function checkUrlForData() {
            // è·å–URLä¸­çš„hashéƒ¨åˆ†
            const hash = window.location.hash;
            
            if (hash && hash.includes('data=')) {
                // ä»URLä¸­æå–ç¼–ç çš„æ•°æ®
                const encodedData = hash.split('data=')[1];
                
                // å¦‚æœæœ‰æ•°æ®ï¼Œå°è¯•è§£ç å¹¶å¯¼å…¥
                setTimeout(() => {
                    importSharedData(encodedData);
                }, 500); // å»¶è¿Ÿ500msï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
            }
        }

        // å¯¼å…¥åˆ†äº«çš„æ•°æ®
        function importSharedData(encodedData) {
            try {
                // è§£ç Base64æ•°æ®
                const decodedData = atob(encodedData);
                const shareData = JSON.parse(decodedData);
                
                // éªŒè¯æ•°æ®å®Œæ•´æ€§
                if (!shareData.scores || shareData.scores.length !== 46) {
                    showMessage("æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ— æ³•å¯¼å…¥", "error");
                    return;
                }
                
                // è®¡ç®—æ ¡éªŒç 
                const calculatedChecksum = shareData.scores.reduce((sum, score) => sum + score, 0);
                if (shareData.checksum && shareData.checksum !== calculatedChecksum) {
                    showMessage("æ•°æ®æ ¡éªŒå¤±è´¥ï¼Œå¯èƒ½å·²è¢«ç¯¡æ”¹", "error");
                    return;
                }
                
                // æ˜¾ç¤ºå¯¼å…¥ç¡®è®¤å¯¹è¯æ¡†
                const time = new Date(shareData.timestamp).toLocaleString();
                const confirmMessage = `å‘ç°åˆ†äº«çš„åˆ†æ•°æ•°æ®ï¼ˆæ›´æ–°æ—¶é—´ï¼š${time}ï¼‰ï¼Œå…±${shareData.studentCount}åå­¦ç”Ÿã€‚\n\næ˜¯å¦è¦å¯¼å…¥è¿™äº›æ•°æ®ï¼Ÿ`;
                
                if (confirm(confirmMessage)) {
                    // åº”ç”¨æ•°æ®
                    scores = new Array(47).fill(100);
                    for (let i = 0; i < 46; i++) {
                        scores[i + 1] = shareData.scores[i];
                    }
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem("classScores", JSON.stringify(scores));
                    
                    // æ¸…é™¤URLä¸­çš„å‚æ•°ï¼ˆé¿å…é‡å¤å¯¼å…¥ï¼‰
                    window.location.hash = '';
                    
                    showMessage(`âœ… æˆåŠŸå¯¼å…¥${shareData.studentCount}åå­¦ç”Ÿçš„åˆ†æ•°æ•°æ®ï¼`);
                    
                    // å¦‚æœå·²ç™»å½•ï¼Œåˆ·æ–°æ˜¾ç¤º
                    if (isLoggedIn) {
                        showScoreList();
                    } else {
                        // å¦‚æœæœªç™»å½•ï¼Œæ˜¾ç¤ºæç¤º
                        showMessage("æ•°æ®å·²å¯¼å…¥ï¼Œè¯·ç™»å½•åæŸ¥çœ‹", "info");
                    }
                } else {
                    // ç”¨æˆ·å–æ¶ˆå¯¼å…¥ï¼Œæ¸…é™¤URLå‚æ•°
                    window.location.hash = '';
                    showMessage("å·²å–æ¶ˆæ•°æ®å¯¼å…¥", "info");
                }
                
            } catch (error) {
                console.error("å¯¼å…¥æ•°æ®å¤±è´¥:", error);
                showMessage("å¯¼å…¥æ•°æ®å¤±è´¥ï¼šæ•°æ®æ ¼å¼é”™è¯¯æˆ–å·²æŸå", "error");
                // æ¸…é™¤é”™è¯¯çš„URLå‚æ•°
                window.location.hash = '';
            }
        }

        // æ˜¾ç¤ºåŒæ­¥é¢æ¿
        function showSyncPanel() {
            if (!isLoggedIn) {
                showMessage("è¯·å…ˆç™»å½•æ‰èƒ½ä½¿ç”¨åŒæ­¥åŠŸèƒ½", "error");
                return;
            }
            
            // æ»šåŠ¨åˆ°åŒæ­¥é¢æ¿
            document.getElementById("syncContainer").scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // æ˜¾ç¤ºåŒæ­¥å¸®åŠ©
        function showSyncHelp() {
            document.getElementById("syncHelpModal").style.display = "flex";
        }

        // ==================== åŸæœ‰åŠŸèƒ½ ====================
        
        // æ˜¾ç¤ºåˆ†æ•°åå•
        function showScoreList() {
            let html = "<h2>å­¦ç”Ÿåˆ†æ•°åå•</h2>";
            html += "<table>";
            html += "<tr><th>åº§å·</th><th>å§“å</th><th>åˆ†æ•°</th></tr>";
            
            for (let i = 1; i <= 46; i++) {
                const scoreClass = scores[i] <= 80 ? "low-score" : "";
                html += `<tr>
                    <td>${i}</td>
                    <td>${studentNames[i]}</td>
                    <td class="${scoreClass}">${scores[i]}</td>
                </tr>`;
            }
            
            html += "</table>";
            document.getElementById("content").innerHTML = html;
        }

        // æ‰“å¼€å¢å‡åˆ†æ•°å¼¹çª—
        function openChangeScoreModal() {
            if (!isLoggedIn) {
                showMessage("è¯·å…ˆç™»å½•æ‰èƒ½ä¿®æ”¹åˆ†æ•°", "error");
                return;
            }
            
            // æ¸…ç©ºä¹‹å‰çš„ä¸´æ—¶æ›´æ”¹
            tempChanges = {};
            
            document.getElementById("changeScoreModal").style.display = "flex";
            renderChangeScoreTable();
        }

        // æ¸²æŸ“å¢å‡åˆ†æ•°è¡¨æ ¼
        function renderChangeScoreTable() {
            let html = "<table>";
            html += "<tr><th>åº§å·</th><th>å§“å</th><th>åŸåˆ†æ•°</th><th>æ›´æ”¹</th><th>æ“ä½œ</th><th>æ›´æ”¹è®°å½•</th></tr>";
            
            for (let i = 1; i <= 46; i++) {
                const originalScore = scores[i];
                const change = tempChanges[i] || 0;
                const tempScore = originalScore + change;
                
                html += `<tr>
                    <td>${i}</td>
                    <td>${studentNames[i]}</td>
                    <td>${originalScore}</td>
                    <td class="temp-change ${change > 0 ? 'positive' : change < 0 ? 'negative' : ''}">
                        ${change > 0 ? '+' : ''}${change !== 0 ? change : ''}
                    </td>
                    <td>
                        <div class="change-buttons">
                            <button class="btn-small btn-add" onclick="addScore(${i})">+5</button>
                            <button class="btn-small btn-add" onclick="addScore(${i}, 1)">+1</button>
                            <button class="btn-small btn-minus" onclick="minusScore(${i}, 1)">-1</button>
                            <button class="btn-small btn-minus" onclick="minusScore(${i})">-5</button>
                            <button class="btn-small" onclick="resetChange(${i})" style="background-color: #6c757d;">é‡ç½®</button>
                        </div>
                    </td>
                    <td class="change-record">
                        ${change !== 0 ? 
                            `<span class="${change > 0 ? 'positive' : 'negative'}">
                                ${originalScore} â†’ ${tempScore} (${change > 0 ? '+' : ''}${change})
                            </span>` : 
                            'æ— æ›´æ”¹'
                        }
                    </td>
                </tr>`;
            }
            
            html += "</table>";
            document.getElementById("changeScoreContent").innerHTML = html;
        }

        // å¢åŠ åˆ†æ•°
        function addScore(studentNo, amount = 5) {
            if (!isLoggedIn) return;
            
            if (!tempChanges[studentNo]) {
                tempChanges[studentNo] = 0;
            }
            tempChanges[studentNo] += amount;
            renderChangeScoreTable();
        }

        // å‡å°‘åˆ†æ•°
        function minusScore(studentNo, amount = 5) {
            if (!isLoggedIn) return;
            
            if (!tempChanges[studentNo]) {
                tempChanges[studentNo] = 0;
            }
            tempChanges[studentNo] -= amount;
            renderChangeScoreTable();
        }

        // é‡ç½®å•ä¸ªæ›´æ”¹
        function resetChange(studentNo) {
            if (!isLoggedIn) return;
            
            delete tempChanges[studentNo];
            renderChangeScoreTable();
        }

        // æ‰¹é‡å¢å‡åˆ†æ•°
        function applyBatchChange(type) {
            if (!isLoggedIn) return;
            
            const batchValue = parseInt(document.getElementById("batchChangeValue").value);
            if (isNaN(batchValue) || batchValue <= 0) {
                showMessage("è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°", "error");
                return;
            }
            
            const changeAmount = type === 'add' ? batchValue : -batchValue;
            
            // åº”ç”¨åˆ°æ‰€æœ‰å­¦ç”Ÿ
            for (let i = 1; i <= 46; i++) {
                if (!tempChanges[i]) {
                    tempChanges[i] = 0;
                }
                tempChanges[i] += changeAmount;
            }
            
            renderChangeScoreTable();
            showMessage(`å·²æ‰¹é‡${type === 'add' ? 'å¢åŠ ' : 'å‡å°‘'}${batchValue}åˆ†`);
        }

        // æ¸…ç©ºæ‰€æœ‰æ›´æ”¹
        function clearAllChanges() {
            if (!isLoggedIn) return;
            
            tempChanges = {};
            renderChangeScoreTable();
            showMessage("å·²æ¸…ç©ºæ‰€æœ‰æ›´æ”¹");
        }

        // åº”ç”¨æ‰€æœ‰æ›´æ”¹
        function applyAllChanges() {
            if (!isLoggedIn) return;
            
            for (const studentNo in tempChanges) {
                const change = tempChanges[studentNo];
                if (change !== 0) {
                    scores[studentNo] += change;
                }
            }
            
            // æ¸…ç©ºä¸´æ—¶æ›´æ”¹
            tempChanges = {};
            
            showMessage("å·²åº”ç”¨æ‰€æœ‰æ›´æ”¹åˆ°å½“å‰ä¼šè¯");
            renderChangeScoreTable();
        }

        // ä¿å­˜æ›´æ”¹åˆ°ç³»ç»Ÿ
        function saveChanges() {
            if (!isLoggedIn) return;
            
            // å…ˆåº”ç”¨æ‰€æœ‰æ›´æ”¹
            applyAllChanges();
            
            // ç„¶åä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveData();
            
            // å…³é—­å¼¹çª—
            closeChangeScoreModal();
            
            showMessage("æ›´æ”¹å·²ä¿å­˜åˆ°ç³»ç»Ÿ");
        }

        // å…³é—­å¢å‡åˆ†æ•°å¼¹çª—
        function closeChangeScoreModal() {
            // æ¸…ç©ºä¸´æ—¶æ›´æ”¹
            tempChanges = {};
            document.getElementById("changeScoreModal").style.display = "none";
        }

        // æ‰“å¼€è®¾ç½®åˆ†æ•°å¼¹çª—
        function openSetScoreModal() {
            if (!isLoggedIn) {
                showMessage("è¯·å…ˆç™»å½•æ‰èƒ½è®¾ç½®åˆ†æ•°", "error");
                return;
            }
            document.getElementById("setScoreModal").style.display = "flex";
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById("setStudentNo").value = "";
            document.getElementById("setScoreValue").value = "";
        }

        // å…³é—­å¼¹çª—
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }

        // è®¾ç½®åˆ†æ•°
        function setScore() {
            if (!isLoggedIn) {
                showMessage("è¯·å…ˆç™»å½•æ‰èƒ½è®¾ç½®åˆ†æ•°", "error");
                return;
            }
            
            const studentNo = parseInt(document.getElementById("setStudentNo").value);
            const scoreValue = parseInt(document.getElementById("setScoreValue").value);
            
            // éªŒè¯è¾“å…¥
            if (isNaN(studentNo) || studentNo < 1 || studentNo > 46) {
                showMessage("åº§å·æ— æ•ˆï¼è¯·è¾“å…¥1-46ä¹‹é—´çš„æ•°å­—", "error");
                return;
            }
            
            if (isNaN(scoreValue)) {
                showMessage("åˆ†æ•°å€¼æ— æ•ˆï¼è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—", "error");
                return;
            }
            
            // éªŒè¯åˆ†æ•°èŒƒå›´
            if (scoreValue < 0 || scoreValue > 200) {
                const confirmSet = confirm(`åˆ†æ•°${scoreValue}è¶…å‡º0-200èŒƒå›´ï¼Œæ˜¯å¦ç»§ç»­è®¾ç½®ï¼Ÿ`);
                if (!confirmSet) {
                    showMessage("å·²å–æ¶ˆè®¾ç½®");
                    return;
                }
            }
            
            // æ‰§è¡Œè®¾ç½®
            scores[studentNo] = scoreValue;
            showMessage(`${studentNo}å·${studentNames[studentNo]}åˆ†æ•°å·²è®¾ç½®ä¸º: ${scoreValue}`);
            
            // å…³é—­å¼¹çª—
            closeModal("setScoreModal");
            // æ›´æ–°æ˜¾ç¤º
            showScoreList();
        }

        // é‡ç½®æ‰€æœ‰åˆ†æ•°ä¸º100
        function resetAllScores() {
            if (!isLoggedIn) {
                showMessage("è¯·å…ˆç™»å½•æ‰èƒ½é‡ç½®åˆ†æ•°", "error");
                return;
            }
            
            const confirmReset = confirm("ç¡®å®šé‡ç½®æ‰€æœ‰å­¦ç”Ÿåˆ†æ•°ä¸º100ï¼Ÿ");
            if (confirmReset) {
                scores = new Array(47).fill(100);
                showMessage("å·²é‡ç½®æ‰€æœ‰å­¦ç”Ÿåˆ†æ•°ä¸º100");
                showScoreList();
            } else {
                showMessage("å·²å–æ¶ˆé‡ç½®æ“ä½œ");
            }
        }

        // æ˜¾ç¤ºåˆ†æ•°è¿‡ä½ï¼ˆ<=80ï¼‰çš„æˆå‘˜
        function showLowScores() {
            let html = "<h2>åˆ†æ•°ä½äº80åˆ†æˆå‘˜</h2>";
            let hasLowScore = false;
            
            html += "<table>";
            html += "<tr><th>åº§å·</th><th>å§“å</th><th>åˆ†æ•°</th></tr>";
            
            for (let i = 1; i <= 46; i++) {
                if (scores[i] <= 80) {
                    hasLowScore = true;
                    html += `<tr>
                        <td>${i}</td>
                        <td>${studentNames[i]}</td>
                        <td class="low-score">${scores[i]}ï¼ˆä½äº80åˆ†ï¼‰</td>
                    </tr>`;
                }
            }
            
            html += "</table>";
            
            if (!hasLowScore) {
                html = "<h2>åˆ†æ•°ä½äº80åˆ†æˆå‘˜</h2><p>æ²¡æœ‰åˆ†æ•°ä½äº80åˆ†çš„æˆå‘˜</p>";
            }
            
            document.getElementById("content").innerHTML = html;
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showMessage(text, type = "success") {
            const messageEl = document.getElementById("message");
            messageEl.textContent = text;
            messageEl.style.display = "block";
            
            // è®¾ç½®æ ·å¼
            if (type === "error") {
                messageEl.style.backgroundColor = "#f8d7da";
                messageEl.style.color = "#721c24";
            } else if (type === "info") {
                messageEl.style.backgroundColor = "#cce5ff";
                messageEl.style.color = "#004085";
            } else {
                messageEl.style.backgroundColor = "#d4edda";
                messageEl.style.color = "#155724";
            }
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                messageEl.style.display = "none";
            }, 3000);
        }

        // ç‚¹å‡»ç©ºç™½å¤„å…³é—­å¼¹çª—
        window.onclick = function(event) {
            const modals = document.getElementsByClassName("modal");
            for (let modal of modals) {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            }
        };
        
        // æŒ‰Enteré”®ç™»å½•
        document.getElementById("password").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                login();
            }
        });
    </script>
</body>
</html>
